<app-nav></app-nav>

<div class="model-container" *ngIf="isAdmin">
  <div class="model-card">
    <h2>Model Training</h2>

    <!-- Requirements Section -->
    <div class="requirements">
      <h3>CSV File Requirements</h3>
      <ul>
        <li><i class="fas fa-file-csv"></i> CSV format with UTF-8 encoding</li>
        <li><i class="fas fa-columns"></i> Required columns:</li>
        <div class="columns-grid">
          <span *ngFor="let col of requiredColumns" class="column-badge">{{col}}</span>
        </div>
        <li><i class="fas fa-weight-hanging"></i> Maximum file size: 100MB</li>
        <li><i class="fas fa-table"></i> At least 10 rows of data</li>
      </ul>
    </div>

    <!-- Upload Section -->
    <div class="upload-section">
      <div
        class="drop-zone"
        appDragDrop
        (fileDropped)="onFileDropped($event)"
        [ngClass]="{'dragover': isDragging}"
        (click)="fileInput.click()"
      >
        <div class="drop-content">
          <i class="fas fa-cloud-upload-alt"></i>
          <div *ngIf="!selectedFile" class="drop-instructions">
            <p>Drag & drop CSV file here</p>
            <p class="or-text">or</p>
            <button class="browse-button">Browse Files</button>
          </div>
          <div *ngIf="selectedFile" class="file-preview">
            <i class="fas fa-file-csv"></i>
            <div class="file-details">
              <p class="filename">{{ selectedFile.name }}</p>
              <p class="filesize">{{ selectedFile.size | fileSize }}</p>
            </div>
          </div>
        </div>
        <input
          #fileInput
          type="file"
          accept=".csv"
          hidden
          (change)="onFileSelected($event)"
        >
      </div>

      <div class="upload-controls">
        <button
          class="upload-button"
          (click)="onSubmit()"
          [disabled]="!selectedFile || uploadStatus === 'uploading'"
        >
          <span *ngIf="uploadStatus !== 'uploading'">Start Training</span>
          <span *ngIf="uploadStatus === 'uploading'">
            <i class="fas fa-spinner fa-spin"></i> Training...
          </span>
        </button>

        <div *ngIf="uploadProgress !== null" class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="uploadProgress"></div>
          </div>
          <span class="progress-text">{{ uploadProgress }}% Complete</span>
        </div>
      </div>
    </div>

    <!-- Status Messages -->
    <div *ngIf="uploadStatus === 'error'" class="status-message error">
      <i class="fas fa-exclamation-circle"></i>
      {{ errorMessage }}
    </div>

    <div *ngIf="uploadStatus === 'success'" class="status-message success">
      <i class="fas fa-check-circle"></i>
      {{ successMessage }}
    </div>
  </div>
</div>

<div *ngIf="!isAdmin" class="unauthorized-message">
  <i class="fas fa-ban"></i>
  You don't have permission to access this page
</div>
