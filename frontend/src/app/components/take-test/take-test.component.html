<app-nav></app-nav>

<div class="auth-container">
  <div class="auth-card">
    <h2 class="auth-title">Diabetes Risk Assessment</h2>

    <form [formGroup]="testForm" (ngSubmit)="onSubmit()" class="test-form">
      <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

      <!-- Step 0: Welcome Step -->
      <div *ngIf="currentStep === 0" class="form-section start-step text-center">
        <h3>Ready to assess your diabetes risk?</h3>
        <p>Click the button below to begin the test.</p>

        <div *ngIf="isAdmin" class="form-group mt-4">
          <label>Patient Full Name</label>
          <input type="text" formControlName="full_name" placeholder="e.g. Sarah Mohammed" title="Enter full name">
        </div>

        <div class="form-actions mt-4">
          <button type="button" (click)="nextStep()">Start Now</button>
        </div>
      </div>

      <!-- Step 1: Basic Information Section -->
      <div *ngIf="currentStep === 1" class="form-section">
        <h3>Basic Information</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Sex</label>
            <select formControlName="sex" title="Select gender">
              <option value="" disabled>Select gender</option>
              <option value="0">Female</option>
              <option value="1">Male</option>
            </select>
          </div>

          <div class="form-group">
            <label>Age Group (1-13)</label>
            <input type="number" formControlName="age" min="1" max="13" title="Enter your age group from 1 to 13">
            <div class="hint">1: 18-24, 2: 25-29, ..., 13: 80+</div>
          </div>

          <div class="form-group">
            <label>BMI</label>
            <input type="number" formControlName="bmi" step="0.1" min="10" max="100" title="Enter Body Mass Index">
          </div>
        </div>
      </div>

      <!-- Step 2: Health Indicators Section -->
      <div *ngIf="currentStep === 2" class="form-section">
        <h3>Health Indicators</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>High Blood Pressure</label>
            <select formControlName="high_bp" title="Do you have high blood pressure?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>High Cholesterol</label>
            <select formControlName="high_chol" title="Do you have high cholesterol?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Cholesterol Check (Last 5 Years)</label>
            <select formControlName="chol_check" title="Have you had a cholesterol check in the last 5 years?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 3: Lifestyle Factors Section -->
      <div *ngIf="currentStep === 3" class="form-section">
        <h3>Lifestyle Factors</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Smoker</label>
            <select formControlName="smoker" title="Do you currently smoke?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Heavy Alcohol Consumption</label>
            <select formControlName="hvy_alcohol" title="Do you consume alcohol heavily?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Fruit Consumption (Daily)</label>
            <select formControlName="fruits" title="Do you eat fruits daily?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Vegetable Consumption (Daily)</label>
            <select formControlName="veggies" title="Do you eat vegetables daily?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 4: Medical History Section -->
      <div *ngIf="currentStep === 4" class="form-section">
        <h3>Medical History</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>Stroke History</label>
            <select formControlName="stroke" title="Have you ever had a stroke?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Heart Disease</label>
            <select formControlName="heart_disease" title="Have you been diagnosed with heart disease?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Difficulty Walking</label>
            <select formControlName="diff_walk" title="Do you have difficulty walking?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Step 5: Health Status Section -->
      <div *ngIf="currentStep === 5" class="form-section">
        <h3>Health Status</h3>
        <div class="form-grid">
          <div class="form-group">
            <label>General Health (1-5)</label>
            <select formControlName="gen_hlth" title="Rate your general health from 1 (Excellent) to 5 (Poor)">
              <option value="1">Excellent</option>
              <option value="2">Very Good</option>
              <option value="3">Good</option>
              <option value="4">Fair</option>
              <option value="5">Poor</option>
            </select>
          </div>

          <div class="form-group">
            <label>Physical Activity</label>
            <select formControlName="phys_activity" title="Do you engage in any physical activity?">
              <option value="0">No</option>
              <option value="1">Yes</option>
            </select>
          </div>

          <div class="form-group">
            <label>Mental Health Days (0-30)</label>
            <input type="number" formControlName="ment_hlth" min="0" max="30" title="Number of days with poor mental health in the past month">
          </div>

          <div class="form-group">
            <label>Physical Health Days (0-30)</label>
            <input type="number" formControlName="phys_hlth" min="0" max="30" title="Number of days with poor physical health in the past month">
          </div>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="form-actions" *ngIf="currentStep > 0 && currentStep <= 5">
        <button type="button" (click)="prevStep()">Back</button>
        <button type="button" (click)="nextStep()" *ngIf="currentStep < 5">Next</button>
        <button type="submit" *ngIf="currentStep === 5" [disabled]="isLoading">
          <span *ngIf="!isLoading">
            <i class="fas fa-check-circle"></i> Submit Assessment
          </span>
          <span *ngIf="isLoading" class="loading">
            <i class="fas fa-spinner fa-spin"></i> Processing...
          </span>
        </button>
      </div>
    </form>
  </div>
</div>

